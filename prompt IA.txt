Bonjour ! Je te recrute comme partenaire de d√©veloppement pour mon projet personnel "Job Alert". Pour que tu puisses m'aider efficacement, je te fournis un contexte complet et d√©taill√© du projet. Comprendre son histoire, ses d√©fis, son architecture et notre m√©thode de travail est crucial pour notre collaboration.

üéØ Objectif Principal et Stack Technique
Nom du Projet : Job Alert

Objectif : Scraper, centraliser et filtrer des offres d'emploi provenant des sites carri√®res de plusieurs banques. Le but est de fournir une interface web simple pour les consulter et d'avoir des notifications Discord pour les nouvelles offres.

Stack Technique :

Backend / Collecte : Scripts Python.

Base de Donn√©es : SQLite (storage/jobs.db).

Notifications : Discord via Webhooks.

Frontend / API : Next.js 15 avec TypeScript et Shadcn/ui.

Mod√®le de donn√©es principal : Un objet JobPosting d√©fini dans models.py.

üèõÔ∏è Architecture Fonctionnelle "par Couches"
Le projet est organis√© en plusieurs couches logiques :

Couche 1 : Le Chef d'Orchestre (collector.py)

R√¥le : Point d'entr√©e du processus. Il lit config.yaml pour savoir quelles banques interroger, appelle dynamiquement le bon fetcher, g√®re la comparaison avec la base de donn√©es (is_new et is_new_by_link) et d√©clenche les notifications.

Couche 2 : Les Sp√©cialistes (fetchers/*.py)

R√¥le : Chaque fichier est un expert pour une banque ou un type de site (ex: workday.py, hsbc.py). Il est responsable de r√©cup√©rer une liste brute d'objets JobPosting.

Couche 3 : L'Outil d'Extraction JSON-LD (fetchers/scraper.py)

R√¥le : Composant r√©utilisable dont l'unique but est d'extraire des donn√©es structur√©es (<script type="application/ld+json">) d'une page de d√©tail. Il est utilis√© par certains fetchers, notamment workday.py. Il est con√ßu pour √™tre tol√©rant et ne pas planter s'il ne trouve pas la balise.

Couche 4 : L'Organisateur (storage/classifier.py)

R√¥le : Standardiser et enrichir les donn√©es (ex: normalize_contract_type, classify_job).

Couche 5 : L'Archive (storage/sqlite_repo.py)

R√¥le : G√©rer toutes les interactions avec jobs.db. Contient init_db, save_job, is_new (par ID) et is_new_by_link (par URL).

Couche 6 : Les Notifieurs (notifiers/discord_embed.py)

R√¥le : G√©rer l'envoi des alertes format√©es sur Discord. L'URL du webhook est r√©cup√©r√©e depuis une variable d'environnement.

üìú Le Playbook "Job Alert" : Notre Processus de D√©veloppement Garanti
Nous suivons un processus strict pour ajouter de nouvelles banques qui n'utilisent pas une plateforme connue comme Workday.

Phase 1 : Mission d'Extraction HTML (Ton R√¥le)

Objectif : Obtenir une copie parfaite du code HTML de la page des offres, apr√®s chargement complet du JavaScript.

Ton Action : Tu me fournis un script Python ponctuel qui utilise Playwright pour naviguer vers l'URL des offres, attendre 15 secondes, et sauvegarder le HTML dans un fichier debug_page_NOM_BANQUE.html.

Phase 2 : Analyse Chirurgicale du HTML (Mon R√¥le)

Objectif : Identifier la structure exacte d'une carte d'offre d'emploi.

Mon Action : J'ouvre le fichier HTML g√©n√©r√©, je trouve le conteneur d'une offre et je te copie-colle cet extrait de 30-40 lignes.

Phase 3 : D√©veloppement et Int√©gration (Ton R√¥le et le Mien)

Ton R√¥le (D√©veloppement) : En te basant sur mon extrait HTML, tu m'√©cris le code final et fonctionnel du fetcher (fetchers/nom_banque.py). Ce code doit extraire toutes les donn√©es, les standardiser et assigner une source (cl√© courte en majuscules, ex: "KC", "ODDO").

Ton R√¥le (Guide) : Une fois le fetcher pr√™t, tu me guides pour les 3 modifications d'int√©gration :

Mise √† jour de collector.py (ajout de l'import et de l'entr√©e dans le dictionnaire FETCHERS).

Mise √† jour de config.yaml (ajout de l'entr√©e dans la liste banks).

Mise √† jour de ui/src/config/banks.ts (ajout de l'objet de configuration dans BANK_CONFIG).

üß† Les Pi√®ges √† √âviter et Nos Conventions (Crucial)
Ceci est la section la plus importante pour √©viter les erreurs que nous avons d√©j√† faites.

Workday est Complexe : Notre fetcher workday.py est le plus complexe.

Strat√©gie Hybride : Il utilise httpx pour r√©cup√©rer la liste des offres via l'API, puis Playwright pour visiter chaque page de d√©tail et l'enrichir avec le JSON-LD.

Rate Limiting : Certains portails Workday (Rothschild, MUFG...) bloquent Playwright s'il visite les pages de d√©tail trop vite. La solution est un d√©lai de courtoisie (page.wait_for_timeout(500)) entre chaque visite.

Limite de l'API : Certains portails (Deutsche Bank) renvoient une erreur 400 Bad Request si la limit de la requ√™te API est trop haute. Notre fetcher utilise une pagination intelligente (il fait plusieurs appels avec une limite interne de 20) pour contourner ce probl√®me.

Pas de Fallback : Nous avons d√©cid√© de ne PAS utiliser de mode "bi-mode" ou de "fallback 100% Playwright". La strat√©gie hybride (API + d√©tails) est la seule utilis√©e.

Gestion des Secrets : L'URL du webhook Discord n'est PAS dans config.yaml. Elle est charg√©e par python-dotenv depuis un fichier .env √† la racine, via la variable DISCORD_WEBHOOK_URL.

V√©rification des "Nouvelles" Offres : Notre logique de d√©tection est double pour plus de robustesse. Dans collector.py, nous utilisons if is_new(job.id) and is_new_by_link(job.link):. C'est crucial.

Consistance des Cl√©s : La cl√© de la source (ex: "KC", "ODDO", "DB") doit √™tre strictement identique (majuscules, format court) dans :

L'assignation job.source dans le fetcher.

La cl√© de l'entr√©e dans BANK_CONFIG dans ui/src/config/banks.ts.

La cl√© dans le dictionnaire BANK_COLORS dans notifiers/discord_embed.py.

D√©couverte d'API Cach√©es : Pour Oddo BHF, nous avons d√©couvert que le site chargeait son contenu via une "API HTML" cach√©e. Dans ce cas, nous privil√©gions un fetcher httpx ultra-rapide au lieu de Playwright. La m√©thode pour trouver cette API est d'utiliser l'onglet "R√©seau" (filtre Fetch/XHR) des outils de d√©veloppement du navigateur.

‚öôÔ∏è Exemples de Code Cl√©s (√âtat Actuel)
fetchers/workday.py (Version stable avec pagination et d√©lai)

[Ici, tu copierais le contenu complet de ton fichier fetchers/workday.py final]

fetchers/hsbc.py (Exemple de fetcher 100% Playwright)

...[Contenu de fetchers/hsbc.py]

fetchers/oddo_bhf.py (Exemple de fetcher API HTML)

...[Contenu de fetchers/oddo_bhf.py]

collector.py (Extrait du dictionnaire FETCHERS)

Generated python

...
FETCHERS = {
"workday": fetch_workday,
"sg_proxy": fetch_sg,
"bnp_paribas": fetch_bnp,
# ... toutes les autres entr√©es ...
}

...
Use code with caution.
Python
config.yaml (Exemple de configuration)

Generated yaml
banks:

{type: workday, base: "https://db.wd3.myworkdayjobs.com", tenant: "db", template: "DBWebsite"}

{type: hsbc}

{type: oddo}

...
Use code with caution.
Yaml
6. üöÄ Mon Objectif Imm√©diat
Mon objectif est de continuer √† ajouter de nouvelles banques √† mon projet en suivant scrupuleusement le Playbook et les conventions que nous avons √©tablies. Ta premi√®re t√¢che sera de me demander de te fournir les codes de chaque couche pour que je puisse te mettre dans un contexte clair et pr√©cis.

Es-tu pr√™t √† √™tre mon nouveau partenaire de d√©veloppement ?